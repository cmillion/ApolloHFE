"""Utility module for working with Apollo Heat Flow Experiment data."""

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
plt.ion() # Don't lock up the terminal when displaying a plot.

ipath = '../../heat_flow_experiment_hfe/data/PSPG-00752_1284752997_APOLLO15_HDF_1/'

datafiles = ['a15p1.file_1','a15p1.file_3','a15p1.file_5','a15p2.file_2',
             'a15p2.file_4','a15p1.file_2','a15p1.file_4','a15p2.file_1',
             'a15p2.file_3','a15p2.file_5']

data = {}
for f in datafiles:
    mission = f[:3]
    if not mission in data.keys():
        data[mission] = {}
    probe = f[3:5]
    if not probe in data[mission].keys():
        data[mission][probe] = {}
    sensor = int(f[-1:])
    columns = (['Time','HTR','TREF','TC1','TC2','TC3','TC4']
                                    if sensor is '3' else ['Time','T','dT'])
    data[mission][probe][sensor] = pd.read_csv('{i}{f}'.format(
        i=ipath,f=f),skiprows=1,names=columns,delim_whitespace=True,
                                skipinitialspace=True)#,skipfooter=1)

def plot_rollovers():
    # The signal is rolling over at T of 2/2**n
    plt.axhline(y=0.0, color='r', linestyle='-')
    for p in range(10):
        plt.axhline(y=-2./2**p, color='r', linestyle='-')

# Don't even look at entries with bad values.
ix = np.where((np.array(data['a15']['p1'][1]['Time'])!=-9999) &
              (np.array(data['a15']['p1'][1]['T'])!=-9999) &
              (np.array(data['a15']['p1'][1]['dT'])!=-9999))
Time = np.array(data['a15']['p1'][1]['Time'])[ix]
T = np.array(data['a15']['p1'][1]['T'])[ix]
dT = np.array(data['a15']['p1'][1]['dT'])[ix]

# plt.figure()
# plt.plot(Time,T,'.')
# plt.xlabel('Time')
# plt.ylabel('Temp')
# plot_rollovers()
# plt.ylim([-5,5])
# plt.figure()
# plt.plot(T,'.')
# plt.xlabel('n')
# plt.ylabel('Temp')
# plot_rollovers()
# plt.ylim([-5,5])


""" Manually assign rollovers to data.
 Note: Values >0 are never corrected. These have been flagged with a comment.
 Note: The ~ few data points below zero are always a little bit ambiguous as
       to which correction to use. I have assigned these corrections using
       "best fit" by eye. Such points have been flagged with a comment. You may
       wish to omit them from analysis.
"""
bins=np.array([-2./2**n for n in range(10)])
# [-2., -1., -0.5, -0.25, -0.125, -0.0625, -0.0313, -0.0156, -0.008, -0.004]
T[0:31] = 2*bins[1]-T[0:31]
T[31:150] = 2*bins[0]-T[31:150]
T[150:208] = 2*bins[1]-T[150:208]
T[208:229] = 2*bins[2]-T[208:229]
T[229:235] = 2*bins[3]-T[229:235]
T[235:238] = 2*bins[4]-T[235:238]
T[238:239] = 2*bins[5]-T[238:239]
T[239:240] = 2*bins[6]-T[239:240]
T[240:241] = 2*bins[7]-T[240:241]
T[241:1494] = T[241:1494] # >0
T[1494:1495] = T[1494:1495] # Ambiguous.
T[1495:1496] = 2*bins[-1]-T[1495:1496]
T[1496:1499] = 2*bins[-2]-T[1496:1499]
T[1499:1504] = 2*bins[-3]-T[1499:1504]
T[1504:1511] = 2*bins[-4]-T[1504:1511]
T[1511:1530] = 2*bins[-5]-T[1511:1530]
T[1530:1569] = 2*bins[-6]-T[1530:1569]
T[1569:1648] = 2*bins[-7]-T[1569:1648]
T[1648:1954] = 2*bins[-8]-T[1648:1954]
T[1954:2415] = 2*bins[-9]-T[1954:2415]
T[2415:2447] = 2*bins[-8]-T[2415:2447]
T[2447:2459] = 2*bins[-7]-T[2447:2459]
T[2459:2464] = 2*bins[-6]-T[2459:2464]
T[2464:2467] = 2*bins[-5]-T[2464:2467]
T[2467:2468] = 2*bins[-3]-T[2467:2468] # Ambiguous.
T[2468:2990] = T[2468:2990] # >0
T[2990:2991] = T[2990:2991] # Ambiguous.
T[2991:2992] = 2*bins[6]-T[2991:2992] # Ambiguous.
T[2992:2994] = 2*bins[5]-T[2992:2994] # Slightly ambiguous.
T[2994:2999] = 2*bins[4]-T[2994:2999]
T[2999:3008] = 2*bins[3]-T[2999:3008]
T[3008:3028] = 2*bins[2]-T[3008:3028]
T[3028:3090] = 2*bins[1]-T[3028:3090]
T[3090:3146] = 2*bins[0]-T[3090:3146]
T[3146:3228] = 2*bins[1]-T[3146:3228]
T[3228:3250] = 2*bins[2]-T[3228:3250]
T[3250:3258] = 2*bins[3]-T[3250:3258]
T[3258:3263] = 2*bins[4]-T[3258:3263]
T[3263:3266] = 2*bins[5]-T[3263:3266]
T[3266:3267] = 2*bins[6]-T[3266:3267] # Ambiguous.
T[3267:3760] = T[3267:3760] # >0
T[3760:3761] = T[3760:3761] # Ambiguous.
T[3761:3762] = T[3761:3762] # Ambiguous.
T[3762:3764] = 2*bins[5]-T[3762:3764]
T[3764:3767] = 2*bins[4]-T[3764:3767]
T[3767:3776] = 2*bins[3]-T[3767:3776]
T[3776:3793] = 2*bins[2]-T[3776:3793]
T[3793:3843] = 2*bins[1]-T[3793:3843]
T[3843:3981] = 2*bins[0]-T[3843:3981]
T[3981:4036] = 2*bins[1]-T[3981:4036]
T[4036:4050] = 2*bins[2]-T[4036:4050]
T[4050:4056] = 2*bins[3]-T[4050:4056]
T[4056:4059] = 2*bins[4]-T[4056:4059]
T[4059:4061] = 2*bins[5]-T[4059:4061] # Slightly ambiguous.
T[4061:4062] = 2*bins[6]-T[4061:4062] # Slightly ambiguous.
T[4062:4063] = 2*bins[8]-T[4062:4063] # Ambiguous
T[4063:4524] = T[4063:4524] # >0
T[4524:4525] = T[4524:4525] # Ambiguous
T[4525:4526] = T[4525:4526] # Ambiguous
T[4526:4527] = T[4526:4527] # Ambiguous
T[4527:4529] = 2*bins[-5]-T[4527:4529]
T[4529:4533] = 2*bins[-6]-T[4529:4533]
T[4533:4542] = 2*bins[-7]-T[4533:4542]
T[4542:4559] = 2*bins[-8]-T[4542:4559]
T[4559:4601] = 2*bins[-9]-T[4559:4601]
T[4601:4775] = 2*bins[0]-T[4601:4775]
T[4775:4821] = 2*bins[1]-T[4775:4821]
T[4821:4833] = 2*bins[2]-T[4821:4833]
T[4833:4840] = 2*bins[3]-T[4833:4840]
T[4840:4845] = 2*bins[4]-T[4840:4845]
T[4845:4847] = 2*bins[5]-T[4845:4847]
T[4847:4848] = 2*bins[6]-T[4847:4848] # Slightly ambiguous.
T[4848:4849] = 2*bins[7]-T[4848:4849] # Slightly ambiguous.
T[4849:5295] = T[4849:5295] # >0
T[5295:5296] = 2*bins[-3]-T[5295:5296] # Ambiguous.
T[5296:5297] = 2*bins[-4]-T[5296:5297] # Ambiguous.
T[5297:5299] = 2*bins[-5]-T[5297:5299]
T[5299:5303] = 2*bins[-6]-T[5299:5303]
T[5303:5310] = 2*bins[-7]-T[5303:5310]
T[5310:5327] = 2*bins[-8]-T[5310:5327]
T[5327:5364] = 2*bins[-9]-T[5327:5364]
T[5364:5569] = 2*bins[0]-T[5364:5569]
T[5569:5605] = 2*bins[1]-T[5569:5605]
T[5605:5619] = 2*bins[2]-T[5605:5619]
T[5619:5628] = 2*bins[3]-T[5619:5628]
T[5628:5635] = 2*bins[4]-T[5628:5635]
T[5635:5638] = 2*bins[5]-T[5635:5638]
T[5638:5639] = 2*bins[6]-T[5638:5639] # Ambiguous.
T[5639:5640] = 2*bins[8]-T[5639:5640] # Ambiguous.
T[5640:6056] = T[5640:6056] # >0
T[5641:6057] = T[5641:6057] # Ambiguous.
T[5642:6058] = T[5642:6058] # Ambiguous.
T[6058:6060] = 2*bins[-5]-T[6058:6060]
T[6060:6065] = 2*bins[-6]-T[6060:6065]
T[6065:6071] = 2*bins[-7]-T[6065:6071]
T[6071:6085] = 2*bins[-8]-T[6071:6085]
T[6085:6120] = 2*bins[-9]-T[6085:6120]
T[6120:6327] = 2*bins[0]-T[6120:6327]
T[6327:6355] = 2*bins[1]-T[6327:6355]
T[6355:6371] = 2*bins[2]-T[6355:6371]
T[6371:6381] = 2*bins[3]-T[6371:6381]
T[6381:6385] = 2*bins[4]-T[6381:6385]
T[6385:6388] = 2*bins[5]-T[6385:6388]
T[6388:6390] = 2*bins[6]-T[6388:6390]
T[6390:6391] = 2*bins[7]-T[6390:6391]
T[6391:6392] = 2*bins[8]-T[6391:6392] # Ambiguous.
T[6392:7066] = T[6392:7066] # >0
T[7066:7067] = 2*bins[-3]-T[7066:7067] # Ambiguous.
T[7067:7068] = 2*bins[-4]-T[7067:7068] # Ambiguous.
T[7068:7070] = 2*bins[-5]-T[7068:7070]
T[7070:7074] = 2*bins[-6]-T[7070:7074]
T[7074:7081] = 2*bins[-7]-T[7074:7081]
T[7081:7096] = 2*bins[-8]-T[7081:7096]
T[7096:7132] = 2*bins[-9]-T[7096:7132]
T[7132:7355] = 2*bins[0]-T[7132:7355]
T[7355:7380] = 2*bins[1]-T[7355:7380]
T[7380:7398] = 2*bins[2]-T[7380:7398]
T[7398:7411] = 2*bins[3]-T[7398:7411]
T[7411:7419] = 2*bins[4]-T[7411:7419]
T[7419:7421] = 2*bins[5]-T[7419:7421]
T[7421:7424] = 2*bins[6]-T[7421:7424]
T[7424:7425] = T[7424:7425] # Ambiguous.
T[7425:8154] = T[7425:8154] # >0
T[8154:8155] = 2*bins[-1]-T[8154:8155] # Ambiguous.
T[8155:8156] = 2*bins[-4]-T[8155:8156] # Ambiguous.
T[8156:8158] = 2*bins[-5]-T[8156:8158]
T[8158:8162] = 2*bins[-6]-T[8158:8162]
T[8162:8169] = 2*bins[-7]-T[8162:8169]
T[8169:8186] = 2*bins[-8]-T[8169:8186]
T[8186:8220] = 2*bins[-9]-T[8186:8220]
T[8220:8463] = 2*bins[0]-T[8220:8463]
T[8463:8488] = 2*bins[1]-T[8463:8488]
T[8488:8508] = 2*bins[2]-T[8488:8508]
T[8508:8521] = 2*bins[3]-T[8508:8521]
T[8521:8528] = 2*bins[4]-T[8521:8528]
T[8528:8531] = 2*bins[5]-T[8528:8531]
T[8531:8533] = 2*bins[6]-T[8531:8533]
T[8533:8534] = 2*bins[7]-T[8533:8534]
T[8534:8535] = 2*bins[8]-T[8534:8535] # Ambiguous.
T[8535:8911] = T[8535:8911] # >0
T[8911:8912] = 2*bins[-1]-T[8911:8912] # Ambiguous.
T[8912:8913] = 2*bins[-4]-T[8912:8913] # Ambiguous.
T[8913:8915] = 2*bins[-5]-T[8913:8915]
T[8915:8919] = 2*bins[-6]-T[8915:8919]
T[8919:8927] = 2*bins[-7]-T[8919:8927]
T[8927:8943] = 2*bins[-8]-T[8927:8943]
T[8943:8977] = 2*bins[1]-T[8943:8977]
T[8977:9217] = 2*bins[0]-T[8977:9217]
T[9217:9247] = 2*bins[1]-T[9217:9247]
T[9247:9267] = 2*bins[2]-T[9247:9267]
T[9267:9280] = 2*bins[3]-T[9267:9280]
T[9280:9288] = 2*bins[4]-T[9280:9288]
T[9288:9292] = 2*bins[5]-T[9288:9292]
T[9292:9294] = 2*bins[6]-T[9292:9294]
T[9294:9295] = 2*bins[7]-T[9294:9295] # Ambiguous.
T[9295:9296] = 2*bins[-1]-T[9295:9296] # Ambiguous.
T[9296:9670] = T[9296:9670] # >0
T[9670:9671] = T[9670:9671] # Ambiguous.
T[9671:9672] = 2*bins[-4]-T[9671:9672] # Ambiguous.
T[9672:9673] = 2*bins[-5]-T[9672:9673]
T[9673:9677] = 2*bins[-6]-T[9673:9677]
T[9677:9686] = 2*bins[-7]-T[9677:9686]
T[9686:9705] = 2*bins[-8]-T[9686:9705]
T[9705:9739] = 2*bins[-9]-T[9705:9739]
T[9739:9975] = 2*bins[0]-T[9739:9975]
T[9975:10000] = 2*bins[1]-T[9975:10000]
T[10000:10020] = 2*bins[2]-T[10000:10020]
T[10020:10032] = 2*bins[3]-T[10020:10032]
T[10032:10039] = 2*bins[4]-T[10032:10039]
T[10039:10043] = 2*bins[5]-T[10039:10043]
T[10043:10044] = 2*bins[7]-T[10043:10044] # Ambiguous.
T[10044:10427] = T[10044:10427] # >0
T[10427:10428] = 2*bins[-3]-T[10427:10428] # Ambiguous.
T[10428:10430] = 2*bins[-5]-T[10428:10430]
T[10430:10434] = 2*bins[-6]-T[10430:10434]
T[10434:10442] = 2*bins[-7]-T[10434:10442]
T[10442:10460] = 2*bins[-8]-T[10442:10460]
T[10460:10496] = 2*bins[-9]-T[10460:10496]
T[10496:10728] = 2*bins[0]-T[10496:10728]
T[10728:10754] = 2*bins[1]-T[10728:10754]
T[10754:10775] = 2*bins[2]-T[10754:10775]
T[10775:10788] = 2*bins[3]-T[10775:10788]
T[10788:10795] = 2*bins[4]-T[10788:10795]
T[10795:10799] = 2*bins[5]-T[10795:10799]
T[10799:10800] = 2*bins[6]-T[10799:10800]
T[10800:10801] = 2*bins[7]-T[10800:10801] # Ambiguous.
T[10801:10802] = 2*bins[7]-T[10801:10802] # Ambiguous.
T[10802:10803] = 2*bins[9]-T[10802:10803] # Ambiguous.
T[10803:11180] = T[10803:11180] # >0
T[11180:11181] = 2*bins[-4]-T[11180:11181] # Ambiguous.
T[11181:11183] = 2*bins[-5]-T[11181:11183]
T[11183:11187] = 2*bins[-6]-T[11183:11187]
T[11187:11195] = 2*bins[-7]-T[11187:11195]
T[11195:11213] = 2*bins[-8]-T[11195:11213]
T[11213:11250] = 2*bins[-9]-T[11213:11250]
T[11250:11494] = 2*bins[0]-T[11250:11494]
T[11494:11526] = 2*bins[1]-T[11494:11526]
T[11526:11541] = 2*bins[2]-T[11526:11541]
T[11541:11554] = 2*bins[3]-T[11541:11554]
T[11554:11561] = 2*bins[4]-T[11554:11561]
T[11561:11565] = 2*bins[5]-T[11561:11565]
T[11565:11567] = 2*bins[6]-T[11565:11567]
T[11567:11568] = 2*bins[7]-T[11567:11568] # Ambiguous.
T[11568:11569] = 2*bins[8]-T[11568:11569] # Ambiguous.
T[11569:11961] = T[11569:11961] # >0
T[11961:11962] = T[11961:11962] # Ambiguous.
T[11962:11963] = 2*bins[-4]-T[11962:11963] # Ambiguous.
T[11963:11965] = 2*bins[-5]-T[11963:11965]
T[11965:11968] = 2*bins[-6]-T[11965:11968]
T[11968:11976] = 2*bins[-7]-T[11968:11976]
T[11976:11993] = 2*bins[-8]-T[11976:11993]
T[11993:12033] = 2*bins[-9]-T[11993:12033]
T[12033:12246] = 2*bins[0]-T[12033:12246]
T[12246:12275] = 2*bins[1]-T[12246:12275]
T[12275:12293] = 2*bins[2]-T[12275:12293]
T[12293:12305] = 2*bins[3]-T[12293:12305]
T[12305:12315] = 2*bins[4]-T[12305:12315]
T[12315:12318] = 2*bins[5]-T[12315:12318]
T[12318:12320] = 2*bins[6]-T[12318:12320]
T[12320:12321] = T[12320:12321] # Ambiguous.
T[12321:12730] = T[12321:12730] # >0
T[12730:12731] = 2*bins[-3]-T[12730:12731] # Ambiguous.
T[12731:12732] = 2*bins[-4]-T[12731:12732] # Ambiguous.
T[12732:12733] = 2*bins[-5]-T[12732:12733] # Ambiguous.
T[12733:12737] = 2*bins[-6]-T[12733:12737]
T[12737:12744] = 2*bins[-7]-T[12737:12744]
T[12744:12761] = 2*bins[-8]-T[12744:12761]
T[12761:12798] = 2*bins[-9]-T[12761:12798]
T[12798:13003] = 2*bins[0]-T[12798:13003]
T[13003:13033] = 2*bins[1]-T[13003:13033]
T[13033:13049] = 2*bins[2]-T[13033:13049]
T[13049:13059] = 2*bins[3]-T[13049:13059]
T[13059:13065] = 2*bins[4]-T[13059:13065]
T[13065:13068] = 2*bins[5]-T[13065:13068]
T[13068:13069] = 2*bins[6]-T[13068:13069]
T[13069:13070] = 2*bins[7]-T[13069:13070] # Ambiguous.
T[13070:13071] = 2*bins[8]-T[13070:13071] # Very ambiguous.
T[13071:13569] = T[13071:13569] # >0
T[13569:13570] = 2*bins[-3]-T[13569:13570] # Ambiguous.
T[13570:13571] = 2*bins[-4]-T[13570:13571] # Ambiguous.
T[13571:13572] = 2*bins[-5]-T[13571:13572] # Ambiguous.
T[13572:13573] = 2*bins[-5]-T[13572:13573] # Ambiguous.
T[13573:13577] = 2*bins[-6]-T[13573:13577]
T[13577:13586] = 2*bins[-7]-T[13577:13586]
T[13586:13602] = 2*bins[-8]-T[13586:13602]
T[13602:13639] = 2*bins[-9]-T[13602:13639]
T[13639:13846] = 2*bins[0]-T[13639:13846]
T[13846:13876] = 2*bins[1]-T[13846:13876]
T[13876:13892] = 2*bins[2]-T[13876:13892]
T[13892:13902] = 2*bins[3]-T[13892:13902]
T[13902:13907] = 2*bins[4]-T[13902:13907]
T[13907:13910] = 2*bins[5]-T[13907:13910]
T[13910:13912] = 2*bins[6]-T[13910:13912]
T[13912:13913] = 2*bins[8]-T[13912:13913] # Ambiguous.
T[13913:14317] = T[13913:14317] # >0
T[14317:14318] = 2*bins[-3]-T[14317:14318] # Ambiguous.
T[14318:14320] = 2*bins[-5]-T[14318:14320]
T[14320:14324] = 2*bins[-6]-T[14320:14324]
T[14324:14332] = 2*bins[-7]-T[14324:14332]
T[14332:14348] = 2*bins[-8]-T[14332:14348]
T[14348:14382] = 2*bins[-9]-T[14348:14382]
T[14382:14596] = 2*bins[0]-T[14382:14596]
T[14596:14624] = 2*bins[1]-T[14596:14624]
T[14624:14640] = 2*bins[2]-T[14624:14640]
T[14640:14651] = 2*bins[3]-T[14640:14651]
T[14651:14657] = 2*bins[4]-T[14651:14657]
T[14657:14660] = 2*bins[5]-T[14657:14660]
T[14660:14662] = 2*bins[6]-T[14660:14662]
T[14662:14663] = 2*bins[7]-T[14662:14663] # Ambiguous.
T[14663:14664] = 2*bins[-1]-T[14663:14664] # Ambiguous.
T[14664:15069] = T[14664:15069] # >0
T[15069:15070] = 2*bins[-2]-T[15069:15070] # Ambiguous.
T[15070:15071] = 2*bins[-4]-T[15070:15071] # Ambiguous.
T[15071:15073] = 2*bins[-5]-T[15071:15073]
T[15073:15076] = 2*bins[-6]-T[15073:15076]
T[15076:15084] = 2*bins[-7]-T[15076:15084]
T[15084:15100] = 2*bins[2]-T[15084:15100]
T[15100:15138] = 2*bins[1]-T[15100:15138]
T[15138:15353] = 2*bins[0]-T[15138:15353]
T[15353:15380] = 2*bins[1]-T[15353:15380]
T[15380:15397] = 2*bins[2]-T[15380:15397]
T[15397:15409] = 2*bins[3]-T[15397:15409]
T[15409:15415] = 2*bins[4]-T[15409:15415]
T[15415:15419] = 2*bins[5]-T[15415:15419]
T[15419:15420] = 2*bins[6]-T[15419:15420] # Ambiguous.
T[15420:15421] = 2*bins[-3]-T[15420:15421] # Ambiguous.
T[15421:15422] = 2*bins[-2]-T[15421:15422] # Ambiguous.
T[15422:15827] = T[15422:15827] # >0
T[15827:15828] = 2*bins[-1]-T[15827:15828]
T[15828:15829] = 2*bins[-4]-T[15828:15829]
T[15829:15831] = 2*bins[-5]-T[15829:15831]
T[15831:15835] = 2*bins[-6]-T[15831:15835]
T[15835:15842] = 2*bins[-7]-T[15835:15842]
T[15842:15859] = 2*bins[-8]-T[15842:15859]
T[15859:15893] = 2*bins[-9]-T[15859:15893]
T[15893:16135] = 2*bins[0]-T[15893:16135]
T[16135:16160] = 2*bins[1]-T[16135:16160]
T[16160:16182] = 2*bins[2]-T[16160:16182]
T[16182:16194] = 2*bins[3]-T[16182:16194]
T[16194:16203] = 2*bins[4]-T[16194:16203]
T[16203:16206] = 2*bins[5]-T[16203:16206]
T[16206:16208] = 2*bins[6]-T[16206:16208]
T[16208:16209] = 2*bins[7]-T[16208:16209] # Ambiguous.
T[16209:16210] = 2*bins[8]-T[16209:16210] # Ambiguous.
T[16210:16594] = T[16210:16594] # >0
T[16594:16596] = 2*bins[-5]-T[16594:16596]
T[16596:16599] = 2*bins[-6]-T[16596:16599]
T[16599:16606] = 2*bins[-7]-T[16599:16606]
T[16606:16622] = 2*bins[-8]-T[16606:16622]
T[16622:16654] = 2*bins[-9]-T[16622:16654]
T[16654:16899] = 2*bins[0]-T[16654:16899]
T[16899:16928] = 2*bins[1]-T[16899:16928]
T[16928:16948] = 2*bins[2]-T[16928:16948]
T[16948:16962] = 2*bins[3]-T[16948:16962]
T[16962:16969] = 2*bins[4]-T[16962:16969]
T[16969:16973] = 2*bins[5]-T[16969:16973]
T[16973:16975] = 2*bins[-4]-T[16973:16975]
T[16975:16976] = 2*bins[-3]-T[16975:16976] # Ambiguous.
T[16976:16977] = 2*bins[-3]-T[16976:16977] # Ambiguous.
T[16977:16978] = 2*bins[-2]-T[16977:16978] # Ambiguous.
T[16978:16979] = 2*bins[-1]-T[16978:16979] # Ambiguous.
T[16979:17350] = T[16979:17350] # >0
T[17350:17351] = 2*bins[-1]-T[17350:17351] # Ambiguous.
T[17351:17352] = 2*bins[-4]-T[17351:17352] # Ambiguous.
T[17352:17354] = 2*bins[-5]-T[17352:17354]
T[17354:17358] = 2*bins[-6]-T[17354:17358]
T[17358:17365] = 2*bins[-7]-T[17358:17365]
T[17365:17381] = 2*bins[-8]-T[17365:17381]
T[17381:17416] = 2*bins[-9]-T[17381:17416]
T[17416:17633] = 2*bins[0]-T[17416:17633]
T[17633:17661] = 2*bins[1]-T[17633:17661]
T[17661:17687] = 2*bins[2]-T[17661:17687]
T[17687:17702] = 2*bins[3]-T[17687:17702]
T[17702:17710] = 2*bins[4]-T[17702:17710]
T[17710:17717] = 2*bins[5]-T[17710:17717]
T[17717:17719] = 2*bins[6]-T[17717:17719]
T[17719:17720] = 2*bins[7]-T[17719:17720] # Ambiguous.
T[17720:17721] = 2*bins[9]-T[17720:17721] # Ambiguous.
T[17721:18108] = T[17721:18108] # >0
T[18108:18109] = 2*bins[-3]-T[18108:18109] # Ambiguous.
T[18109:18112] = 2*bins[-5]-T[18109:18112]
T[18112:18116] = 2*bins[-6]-T[18112:18116]
T[18116:18124] = 2*bins[-7]-T[18116:18124]
T[18124:18140] = 2*bins[-8]-T[18124:18140]
T[18140:18175] = 2*bins[-9]-T[18140:18175]
T[18175:18427] = 2*bins[0]-T[18175:18427]
T[18427:18454] = 2*bins[1]-T[18427:18454]
T[18454:18477] = 2*bins[2]-T[18454:18477]
T[18477:18491] = 2*bins[3]-T[18477:18491]
T[18491:18499] = 2*bins[4]-T[18491:18499]
T[18499:18504] = 2*bins[5]-T[18499:18504]
T[18504:18506] = 2*bins[-4]-T[18504:18506]
T[18506:18507] = 2*bins[-3]-T[18506:18507] # Ambiguous.
T[18507:18508] = 2*bins[-2]-T[18507:18508] # Ambiguous.
T[18508:18891] = T[18508:18891] # >0
T[18891:18892] = 2*bins[-3]-T[18891:18892] # Ambiguous.
T[18892:18893] = 2*bins[-4]-T[18892:18893] # Ambiguous.
T[18893:18895] = 2*bins[-5]-T[18893:18895]
T[18895:18899] = 2*bins[-6]-T[18895:18899]
T[18899:18906] = 2*bins[-7]-T[18899:18906]
T[18906:18923] = 2*bins[-8]-T[18906:18923]
T[18923:18958] = 2*bins[-9]-T[18923:18958]
T[18958:19241] = 2*bins[0]-T[18958:19241]
T[19241:19270] = 2*bins[1]-T[19241:19270]
T[19270:19295] = 2*bins[2]-T[19270:19295]
T[19295:19316] = 2*bins[3]-T[19295:19316]
T[19316:19324] = 2*bins[4]-T[19316:19324]
T[19324:19328] = 2*bins[5]-T[19324:19328]
T[19328:19329] = 2*bins[6]-T[19328:19329] # Ambiguous.
T[19329:19330] = 2*bins[7]-T[19329:19330] # Ambiguous.
T[19330:19331] = 2*bins[8]-T[19330:19331] # Ambiguous.
T[19331:20124] = T[19331:20124] # >0
T[20124:20125] = 2*bins[-3]-T[20124:20125] # Ambiguous.
T[20125:20126] = 2*bins[-4]-T[20125:20126] # Ambiguous.
T[20126:20128] = 2*bins[-5]-T[20126:20128] # Ambiguous.
T[20128:20131] = 2*bins[-6]-T[20128:20131]
T[20131:20140] = 2*bins[-7]-T[20131:20140]
T[20140:20157] = 2*bins[-8]-T[20140:20157]
T[20157:20202] = 2*bins[-9]-T[20157:20202]
T[20202:20452] = 2*bins[0]-T[20202:20452]
T[20452:20484] = 2*bins[1]-T[20452:20484]
T[20484:20503] = 2*bins[2]-T[20484:20503]
T[20503:20517] = 2*bins[3]-T[20503:20517]
T[20517:20525] = 2*bins[4]-T[20517:20525]
T[20525:20529] = 2*bins[5]-T[20525:20529]
T[20529:20531] = 2*bins[6]-T[20529:20531]
T[20531:20532] = 2*bins[7]-T[20531:20532] # Ambiguous.
T[20532:20533] = 2*bins[8]-T[20532:20533] # Ambiguous.
T[20533:20534] = 2*bins[9]-T[20533:20534] # Ambiguous.
T[20534:20911] = T[20534:20911] # >0

plt.close('all')
plt.figure()
plt.plot(T,'.')
plt.xlim([16970,20911])
plt.ylim([-4,5])
plt.xlabel('n')
plt.ylabel('Temp')
plot_rollovers()
